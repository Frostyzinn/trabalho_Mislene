<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Agendamento - Perfil Barbeiro Alinhado</title>
  <link rel="stylesheet" href="styleini.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f5f5f5;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-bottom: 40px;
      table-layout: fixed;
      text-align: center;
    }
    th, td {
      padding: 10px;
      border: 1px solid #ccc;
      vertical-align: middle;
      user-select: none;
      cursor: pointer;
    }
    th {
      background-color: #8f0000;
      color: white;
    }
    td.indisponivel {
      background-color: #f8d7da;
      color: #666;
      cursor: default;
    }
    td.disponivel {
      background-color: #d4edda;
    }
    td.marcado {
      background-color: #ffeeba;
    }
    td.cancelado {
      background-color: #d6d8db;
      text-decoration: line-through;
      color: #555;
      cursor: default;
    }
    td .cancelar-btn {
      margin-top: 5px;
      padding: 2px 5px;
      font-size: 12px;
      background-color: red;
      color: white;
      border: none;
      cursor: pointer;
      display: none;
      border-radius: 3px;
    }
    td.marcado .cancelar-btn {
      display: inline-block;
    }
  </style>
</head>
<body>
  
   <nav class="menu-lateral">
    <div class="btn-expandir">
      <i class="bi bi-list" id="btn-exp"></i>
    </div>
    <ul>
      <li class="item-menu">
        <a href="index.html">
          <span class="icon"><i class="bi bi-house-door"></i></span>
          <span class="txt-link">Home</span>
        </a>
      </li>
      <li class="item-menu">
        <a href="barbearias.html">
          <span class="icon"><i class="bi bi-columns-gap"></i></span>
          <span class="txt-link">Barbearias</span>
        </a>
      </li>
      <li class="item-menu ativo">
        <a href="agendamento.html">
          <span class="icon"><i class="bi bi-calendar3"></i></span>
          <span class="txt-link">Agendamentos</span>
        </a>
      </li>
      <li class="item-menu">
        <a href="configuracoes.html">
          <span class="icon"><i class="bi bi-gear"></i></span>
          <span class="txt-link">Configurações</span>
        </a>
      </li>
      <li class="item-menu">
        <a href="#">
          <span class="icon"><i class="bi bi-person-circle"></i></span>
          <span class="txt-link">Conta</span>
        </a>
      </li>
    </ul>
  </nav>

  <h2>Tabela de Serviços e Preços</h2>
  <table>
    <thead>
      <tr>
        <th>Serviço</th>
        <th>Preço (R$)</th>
      </tr>
    </thead>
    <tbody id="servicos-tbody">
      <tr>
        <td contenteditable="true">Corte Masculino</td>
        <td contenteditable="true">30</td>
      </tr>
      <tr>
        <td contenteditable="true">Barba</td>
        <td contenteditable="true">20</td>
      </tr>
    </tbody>
  </table>

  <h2>Horários da Semana</h2>
  <table id="tabela-horarios"></table>

  <script>
    const dias = ["Seg", "Ter", "Qua", "Qui", "Sex", "Sab", "Dom"];
    const horariosSemana = ["00:00", "01:00", "02:00", "03:00", "04:00", "05:00", "06:00","08:00,","09:00,","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00","22:00","23:00"];
    const horariosSabadoDomingo = ["10:00", "11:00", "13:00", "14:00"];

    const tabela = document.getElementById("tabela-horarios");
    const servicosTbody = document.getElementById("servicos-tbody");

    let estadosHorarios = {};

    function horarioPassado(dia, hora) {
      const hoje = new Date();
      const diaSemanaAtual = hoje.getDay();
      const diasMap = { "Dom": 0, "Seg": 1, "Ter": 2, "Qua": 3, "Qui": 4, "Sex": 5, "Sab": 6 };
      const targetDia = diasMap[dia];
      const [h, m] = hora.split(":").map(Number);
      const dataAlvo = new Date();
      const diff = (targetDia - diaSemanaAtual + 7) % 7;
      dataAlvo.setDate(hoje.getDate() + diff);
      dataAlvo.setHours(h, m, 0, 0);
      return dataAlvo < hoje;
    }

    function ordenarHorarios(horarios) {
      return horarios.slice().sort((a, b) => {
        const [ha, ma] = a.split(":").map(Number);
        const [hb, mb] = b.split(":").map(Number);
        if (ha === hb) return ma - mb;
        return ha - hb;
      });
    }

    function renderizarTabelaHorarios() {
      tabela.innerHTML = '';

      // Cabeçalho
      const thead = document.createElement('thead');
      const trHead = document.createElement('tr');
      const thVazio = document.createElement('th');
      thVazio.textContent = 'Horário / Dia';
      trHead.appendChild(thVazio);
      dias.forEach(dia => {
        const th = document.createElement('th');
        th.textContent = dia;
        trHead.appendChild(th);
      });
      thead.appendChild(trHead);
      tabela.appendChild(thead);

      // Determinar todos os horários (união dos dois arrays, para alinhar linhas)
      const todosHorarios = ordenarHorarios([...horariosSemana, ...horariosSabadoDomingo]);

      const tbody = document.createElement('tbody');

      todosHorarios.forEach(hora => {
        const tr = document.createElement('tr');

        // Coluna do horário
        const tdHora = document.createElement('td');
        tdHora.textContent = hora;
        tdHora.style.fontWeight = 'bold';
        tr.appendChild(tdHora);

        // Colunas dos dias
        dias.forEach(dia => {
          const horariosValidos = (dia === 'Sab' || dia === 'Dom') ? horariosSabadoDomingo : horariosSemana;
          const td = document.createElement('td');

          if (!horariosValidos.includes(hora)) {
            td.textContent = '-';
            td.style.color = '#aaa';
            td.style.cursor = 'default';
          } else {
            const key = `${dia}_${hora}`;
            if (!estadosHorarios[key]) {
              estadosHorarios[key] = { estado: 'indisponivel', cliente: '' };
            }
            const estado = estadosHorarios[key].estado;
            const passado = horarioPassado(dia, hora);

            td.className = estado;
            td.textContent = estado === 'marcado' ? `Marcado\n${estadosHorarios[key].cliente}` : estado.charAt(0).toUpperCase() + estado.slice(1);

            if (!passado && (estado === 'indisponivel' || estado === 'disponivel')) {
              td.style.cursor = 'pointer';
              td.addEventListener('click', () => {
                estadosHorarios[key].estado = estado === 'indisponivel' ? 'disponivel' : 'indisponivel';
                renderizarTabelaHorarios();
              });
            }

            if (estado === 'marcado' && !passado) {
              // botão cancelar dentro da célula
              const btnCancelar = document.createElement('button');
              btnCancelar.textContent = 'Cancelar';
              btnCancelar.className = 'cancelar-btn';
              btnCancelar.addEventListener('click', (e) => {
                e.stopPropagation();
                estadosHorarios[key].estado = 'cancelado';
                estadosHorarios[key].cliente = '';
                renderizarTabelaHorarios();
              });
              td.appendChild(document.createElement('br'));
              td.appendChild(btnCancelar);
            }
          }

          tr.appendChild(td);
        });

        tbody.appendChild(tr);
      });

      tabela.appendChild(tbody);
    }

    // Deixa os serviços editáveis para barbeiro
    servicosTbody.querySelectorAll('td').forEach(td => {
      td.contentEditable = true;
    });

    renderizarTabelaHorarios();
  </script>
    
<script src="menu.js"></script>

  <script>
    document.querySelector("form").addEventListener("submit", function(event) {
      event.preventDefault();
      alert("Agendamento realizado com sucesso!");
    });

    if (localStorage.getItem("preferencia_tema_escuro") === "true") {
      document.body.classList.add("dark-mode");
    }
  </script>

</body>
</html>
